<!DOCTYPE html>
<html lang="ko">

<head>
    {{ template "layout/header" . }}

    <style>
        section.form-register {
            display: none;
        }

        #keyarea {
            visibility: hidden;
        }

        .mail-guidance {
            font-size: 0.9em;
        }
    </style>

    <script defer>
        function mailSubmit() {
            fetch('/mail-cert', {
                method: 'POST',
                cache: 'no-cache',
                credentials: "include",
                headers: {
                    'Content-Type': "application/json"
                },
                body: JSON.stringify({
                    mail: document.getElementById("mailbox").value
                })
            })
                .then((response) => {
                    document.getElementById("keyarea").style.visibility = "visible";
                    document.getElementById("cert-sendmail").style.display = "none";
                    document.getElementById("MailMsg").innerText = "메일 발송에 성공했습니다.";
                })
                .catch(error => console.log(error));
            return false;
        }

        function keyCert() {
            fetch('/key-cert', {
                method: 'POST',
                cache: 'no-cache',
                credentials: "include",
                redirect: "follow",
                headers: {
                    'Content-Type': "application/json"
                },
                body: JSON.stringify({
                    key: document.getElementById("certKeybox").value
                })
            })
                .then((response) => {
                    console.log("성공");
                    document.getElementById("KeyCertMsg").innerText = "성공!";
                    window.location.href = response.url;
                })
                .catch((error) => {
                    console.log("실패");
                    console.log(error);
                    document.getElementById("KeyCertMsg").innerText = "번호를 잘못입력했습니다.";
                });
            return false;
        }
    </script>

    <title>대학 이메일 인증</title>
</head>

<body class="center-container text-center">
    <main id="form-register" class="center-content mw-3">
        <h1>회원가입</h1>
        <p class="mail-guidance">
            학생 이메일을 통한 인증이 필요합니다.</br>
            학생 이메일에 대해서 처음들어보셨나요?<br>
            <a href="http://info.wsu.ac.kr">대학정보시스템</a>에서 생성할 수 있습니다.
        </p>
        <form action="/mail-cert" method="post" onsubmit="return mailSubmit()" class="form-floating" id="mailarea">
            <input type="text" class="form-control" name="mailID" id="mailbox">
            <label for="mailbox">아이디(@live.wsu.ac.kr)</label>
            <button class="btn btn-primary mt-4" id="cert-sendmail">인증번호 발송</button>
        </form>

        <form action="/key-cert" method="post" class="form-floating" id="keyarea" onsubmit="return keyCert()">
            <input type="text" class="form-control" name="certKey" id="certKeybox">
            <label for="certKeybox">인증번호</label>
            <span id="MailMsg">&nbsp;</span>
            <span id="KeyCertMsg"></span><br>
            <button class="btn btn-primary">인증</button>
        </form>
    </main>
</body>

</html>